---
// import BlogPost from '../../../../components/BlogPost.astro';
import Layout from '../../../../layouts/BlogPost.astro';
import {Markdown} from 'astro/components';

export async function getStaticPaths() {
  let allLegacyPosts = Astro.fetchContent('../../../old-posts/*.md');
  // console.log(`All Legacy Posts: ${JSON.stringify(allLegacyPosts)}`);
  const result = allLegacyPosts.map(post => {
    const url = post.url.replace('/old-posts/', '');
    const year = url.substr(0,4);
    const month = url.substr(5,2);
    const day = url.substr(8,2);
    const name = url.substr(11);
    const slug = '/' + url.replace('-', '/').replace('-', '/').replace('-', '/') + '/';
    console.log(`Post Slug: ${slug}`);
    console.log(`Params: ${year}, ${month}, ${day}, ${name}`);
    return {params: {year, month, day, name}, props: {post}};
  });
  return result;
}

// const {params} = Astro.request;
// const slug = params.slug;
// console.log(`Request Props: ${JSON.stringify(Astro.props)}`);

// Astro.resolve(Astro.props.url);
// console.log(`Astro Content: ${JSON.parse(JSON.stringify(Astro.props))}`);
// const allLegacyPosts1 = Astro.fetchContent('../../../old-posts/*.md');
// const allLegacyPosts1 = Astro.fetchContent('../../old-posts/*.md');
// console.log(`This is the post: ${JSON.stringify(allLegacyPosts1)}`);
// const post = allLegacyPosts1.find(post => {
//   console.log(post.url);
//   return post.url === Astro.props.url
// });

// const allLegacyPosts = Astro.fetchContent('../../../_posts/*.md');
// const postUrl = Astro.props.url;
// console.log(`All Legacy Posts: ${JSON.stringify(allLegacyPosts)}`);
// const post = allLegacyPosts.find(post => {
//   console.log(post.url);
//   return post.url === postUrl
// });
const {name} = Astro.request.params;
console.log(`Name: ${name}`);
const post = Astro.props.post;
// console.log(`Found the post: ${JSON.stringify(post)}`);

let title = 'Clarkio | Blog';
let description = 'Writings by clarkio.'
let permalink = 'https://clarkio.com/blog';
---

<Layout content={{ title, description, permalink }}>
  <Markdown content={post.astro.source}/>
</Layout>

<!-- <body><h1>{name}</h1></body> -->
<!-- <BlogPost title={post.title} author={post.author} heroImage={post.heroImage} publishDate={post.publishDate} alt={post.alt}>
</BlogPost> -->

